// prisma/schema.prisma
// Database schema for Shop Back-Office System

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// Product entity - stores product information
model Product {
  id           Int                 @id @default(autoincrement())
  name         String              @db.VarChar(255)
  sellingPrice Decimal             @map("selling_price") @db.Decimal(10, 2)
  costTotal    Decimal             @default(0) @map("cost_total") @db.Decimal(10, 2)
  createdAt    DateTime            @default(now()) @map("created_at")
  updatedAt    DateTime            @updatedAt @map("updated_at")
  ingredients  ProductIngredient[]

  @@index([name])
  @@map("products")
}

/// Ingredient entity - stores ingredient information
model Ingredient {
  id          Int                 @id @default(autoincrement())
  name        String              @db.VarChar(255)
  costPerUnit Decimal             @map("cost_per_unit") @db.Decimal(10, 4)
  unit        String              @db.VarChar(50)
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  products    ProductIngredient[]

  @@index([name])
  @@map("ingredients")
}

/// Junction table for many-to-many relationship between Product and Ingredient
model ProductIngredient {
  id           Int      @id @default(autoincrement())
  productId    Int      @map("product_id")
  ingredientId Int      @map("ingredient_id")
  quantityUsed Decimal  @map("quantity_used") @db.Decimal(10, 4)
  costTotal    Decimal  @map("cost_total") @db.Decimal(10, 4)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  product    Product    @relation(fields: [productId], references: [id], onDelete: Cascade)
  ingredient Ingredient @relation(fields: [ingredientId], references: [id], onDelete: Restrict)

  @@unique([productId, ingredientId])
  @@index([productId])
  @@index([ingredientId])
  @@map("product_ingredients")
}
